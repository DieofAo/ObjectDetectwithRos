# 1.Aim
This code is order to reconstruct the spatial pose of ArucoTag using binocular cameras with pose and time filtering 
# 2.dependencies
- Opencv 4.2.0
- Eigen 3.3
- C++ 11
# 3.Test Environment
- Ubuntu 20.04 (Linux 5.4.0)
- gcc version 7.5.0(X86_64)
- CMake 3.8.14
# 4.Feature
- 通过旋转矩阵的轴角表示法量化两个旋转矩阵的偏差，得到两个旋转矩阵的弧度制的角度偏差，代码中借用一个单位旋转矩阵进行求范数，来得到角度偏差。
ps：轴角表示法有两种表示方法，1.四个数，三个是轴的向量，是个单位向量，最后一个是旋转的角度2.三个数，是将旋转的角度乘入前三个轴的向量
ps：旋转矩阵的表示方法，1.齐次坐标的旋转矩阵，正常的3x3旋转矩阵或Eigen的“Isometry”数据类型 2.四元数，ijkw，四个维度的数，带一个约束，和轴角表示法有转换关系，这是一种无约束的表示，适合做插值 3.轴角表示法，如上，避免了欧拉角的奇异位形的问题（即欧拉角的多解情况），四个数的轴角表示法或三个数的轴角表示法
- 　对旋转矩阵求平均，即用四元数求平均，会使用到SVD，SVD的几何意义还要挖掘，同时四元数也要用与插值
- 　对四个点（可二维可三维）求构成矩阵的中心点，通过对对角点的坐标进行叉乘的结果（二维就变为齐次坐标，最后别忘归一化，也可以将原理归于直线的ａｘ＋ｂｙ＋ｃ＝０方程），将两对叉乘结果再叉乘就会得到中心点坐标
- 　对自己根据三个点重建一个坐标系，无法保证已知的ｘｙ轴相互垂直，所以先叉乘得到ｚ轴，在将ｚ轴叉乘ｘ轴得到ｙ轴，此时的重建坐标系就是以ｘ轴为完全还原的一个符合要求的标准笛卡尔坐标系
- 　旋转矩阵的求导是进一步要求，以及在SO3上的均匀取值还有待发掘
- 　由于opencv在识别过程中受到滤波器的限制，在ArucoTag码的边缘会存在阶梯型的不稳定的过度
- 　校验重建姿态的准确性的时候由两种方法，１.求重建的与观测到的ｒ的差异。但这种方法无法评估两个姿态是否都准确，如果都不准也可能会得到一个相差不大的结果，以为他们都是准的。２、比较准确的做法是用一个更高精度的仪器来检验，用一个高精度的机器人，告诉他到达重建的姿态，来评估是否准确
- 　当约束过多的时候最小二乘就不好用了，这个时候要引入lm算法
# 5.轨迹规划
- 对于此轨迹规划任务中，有两次容易规划自由度的任务，第一个是在确定机械臂末端抓取炮弹姿态的时候，有一个冗余的以炮弹轴线为轴线的旋转自由度；第二个是在抓取炮弹任务结束后，要在全局相机下确定抓取的实际炮弹姿态的时候，这时的末端姿态有两个冗余自由度，第一个是以炮弹为轴线的一个旋转自由度，第二个是以相机轴线为轴线的第二个旋转自由度。
- 对于第二个两自由度冗余情况，我们定义一种约束，要求炮弹的轴线和相机轴线是垂直的，两个冗余自由度即为绕这两个限制的轴线的旋转自由度。这样就会限制一个反解的合理姿态
- 对于如何解决冗余自由度的限制来确定两次末端位姿，本方案目前采用的策略是当找到第一个可反解的姿态就确定为末端位姿。
- 实际轨迹规划中，留有自定义轨迹的接口，通过三个平移量和旋转矩阵的轴角表示法的旋转角度，四个变量的构建轨迹插值方程。其中的轴角表示法的角度是对四维球面的球面距的定义
# 6.其他
- 针对最小二乘问题，首先lm、牛顿法、牛顿梯度下降法都是针对无约束的优化问题，对于有约束问题常常使用拉格朗日乘子法，通过提高变量维度来减少约束。其中lm算法是确定零点的算法，针对变化曲率缓慢地优化问题使用牛顿梯度下降法是最快的，针对曲率较大的牛顿法的代价最小，lm适合处理介于两者中间的问题。
